import{u as e,s as o,i as a,d as s,o as l,t as n,v as t,x as i,e as r,f as c,y as u,j as d,z as p,B as g,C as v,D as f,k as w,r as h}from"./vendor.4ddb5e7f.js";import{F as m,u as k,w as _,V as O,a as b,h as x,b as C,c as y,d as U,e as T,f as L}from"./main.7cfb0528.js";function I(e){const o=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(atob(o).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(a)}const S={setup(t,i){const r=e(),c=o(),u=k(),d=a(!1),p=a("test"),g=a("test"),v=a(""),f=a("login"),w=a("");let h=0,S="",E=null;const A=()=>{f.value="login",w.value="",h=0};s((()=>console.log("signIn unmounted"))),l((async()=>{console.log("signIn mounted!",c.hash),A(),w.value="111111",v.value="",d.value=!1,_.connect(),_.setMessage((e=>console.log("ws onmessage",e.data))),E=setInterval((async()=>{_?(console.log("ws interval - send"),_.send("Hello "+new Date)):console.log("ws falsy")}),1e4)})),n((()=>{E&&(clearInterval(E),E=null),_&&_.setMessage(null),_.close()}));const M=async(e,o)=>{await r.dispatch("doLogin",o)};return{email:p,password:g,errorMessage:v,loading:d,mode:f,otp:w,login:async()=>{var e;if(console.log("login clicked"),!d.value){d.value=!0,v.value="";try{const{data:e}=await x.post("/api/auth/login",{email:p.value,password:g.value});if(e.otp)f.value="otp",S=e.otp,h=0;else{const o=I(e.access_token);x.setTokens({access:e.access_token,refresh:e.refresh_token}),x.setOptions({refreshUrl:C}),M(0,o)}}catch(o){console.log("login error",o.toString(),o),v.value=(null==(e=null==o?void 0:o.data)?void 0:e.message)||o.toString()}d.value=!1}},otpLogin:async()=>{if(!d.value){d.value=!0,v.value="";try{x.setOptions({refreshUrl:C});const{data:e}=await x.post("/api/auth/otp",{id:S,pin:w.value}),o=I(e.access_token);x.setTokens({access:e.access_token,refresh:e.refresh_token}),x.setOptions({refreshUrl:C}),M(0,o)}catch(e){"Token Expired Error"===e.data.message?(v.value="OTP Expired",A()):h<3?(h++,v.value="OTP Error"):(v.value="OTP Tries Exceeded",A())}d.value=!1}},i18n:u,VITE_CALLBACK_URL:O,VITE_SAML_URL:b,loginSaml:()=>{x.setOptions({refreshUrl:C}),((e,o)=>{const a="443"===window.location.port||"80"===window.location.port?"":":"+window.location.port,s=window.location.protocol+"//"+window.location.hostname+a+o,{urlFull:l}=m.parseUrl(`/api/saml/login?redirect_to=${s}&groups=&expiry=`,e);window.location.assign(l)})(b,O)},loginOidc:()=>{x.setOptions({refreshUrl:y}),window.location.assign(U)},loginOAuth:()=>{x.setOptions({refreshUrl:C}),window.location.replace(`${T}=${L}`)}}}},E=f("data-v-36afedf2");t("data-v-36afedf2");const A={class:"page-flex"},M={key:0},P={class:"form-box-flex"},$={class:"buttons-box-flex"},j=w("Login"),D=w("Fast"),F={class:"buttons-box-flex"},R=w("SAML"),V=w("OIDC"),B=w("Github"),z=w("Sign Up"),G=d("h1",null,"Enter OTP",-1),H={class:"buttons-box-flex"},J=w("OTP"),K={key:0};i();const N=E(((e,o,a,s,l,n)=>{const t=h("a-input"),i=h("a-button"),f=h("router-link");return r(),c("div",A,[s.loading?(r(),c("bwc-loading-overlay",M)):u("",!0),d("form",P,[p(d("div",null,[d("h1",null,v(s.i18n.$t("sign_in")),1),d(t,{label:"Username",type:"text",value:s.email,"onUpdate:value":o[1]||(o[1]=e=>s.email=e)},null,8,["value"]),d(t,{label:"Password",type:"password",value:s.password,"onUpdate:value":o[2]||(o[2]=e=>s.password=e)},null,8,["value"]),d("div",$,[d(i,{onClick:s.login},{default:E((()=>[j])),_:1},8,["onClick"]),d(i,{onClick:o[3]||(o[3]=o=>e.$router.push("/signin-fast"))},{default:E((()=>[D])),_:1})]),d("div",F,[d(i,{onClick:s.loginSaml},{default:E((()=>[R])),_:1},8,["onClick"]),d(i,{onClick:s.loginOidc},{default:E((()=>[V])),_:1},8,["onClick"]),d(i,{onClick:s.loginOAuth},{default:E((()=>[B])),_:1},8,["onClick"])]),d("p",null,[d(f,{to:"/signup"},{default:E((()=>[z])),_:1})])],512),[[g,"login"===s.mode]]),p(d("div",null,[G,d(t,{label:"OTP",type:"text",value:s.otp,"onUpdate:value":o[4]||(o[4]=e=>s.otp=e)},null,8,["value"]),d("div",H,[d(i,{onClick:s.otpLogin},{default:E((()=>[J])),_:1},8,["onClick"])])],512),[[g,"otp"===s.mode]]),s.errorMessage?(r(),c("p",K,v(s.errorMessage),1)):u("",!0)])])}));S.render=N,S.__scopeId="data-v-36afedf2";export default S;
